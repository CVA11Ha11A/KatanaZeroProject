오후 8:33 2023-08-04
카메라 무빙까지함 그리고 콜라이더 세밀한 수정 필요(중간에 걸리는 부분이 있음)

그리고 이제 플레이어 공격, 마우스 포인터 따라서 공격하는것을 구현해야함 



오전 2:50 2023-08-06

마우스 클릭시 클릭한 좌표 구하는 코드

Vector3 point = Camera.main.ScreenToWorldPoint(new Vector3(Input.mousePosition.x, 
		Input.mousePosition.y, -Camera.main.transform.position.z));

좌클릭했을떄 제작중

현제 마우스 좌표 구하는 코드 구했고 플레이어 위치가 마우스 포지션으로 점점 가는로직을
짜야 하는데 어떤식으로 식을 짜야할지 고민

생각난것 
1. AddForce로 순간적으로 힘을주어서 이동 시켜보자

 시도1 : 움직임 슥 하면서 움직이는데 X축이 +값으로만 움직이고 뒤로 못감 조건을 걸어야 겠음
	+한번 플레이 해서 해보니 addforce 위치를 클릭 좌표로했을때에 월드 좌표가 -이면 잘감
	그렇다면 플레이어의 기준이 0 이여야 하고 그기준에서 어떻게 클릭했는지로 봐야겠음

  시도1결과 : 플레이어의 transform.x < mousePotition.x 이런식으로 X,Y 좌표 비교해서 움직이게함
	결과는 매우 만족스러움 하지만 클릭을 연속적으로 했을때에 
	AddForce가 주는 힘이 점점 더해지는거같음 이부분을 마찰력으로 한번 해결해볼까 싶음


AddForce 연속적으로 줄때에 이동하는 힘이 가중되는것 해결해야함

해결 : AddForce 전에 playerRigid.velocity = Vector3.zero; 이 코드로 이동값 초기화후 다시 이동
시켜서 점점 더해지는것을 방지함



클릭 했을때에 공격을 할것이기 떄문에 공격 애니메이션 제작

오전 4:25 2023-08-06
애니메이션 공격모션이 깔끔하지 않음



오후 9:51 2023-08-06

공격 애니메이션을 어떻게 해야할지 고민하다가 Bool을 코루틴으로 시간을 정해주고 True false를
조정 해서 사용하면 어떨까 싶어서 시도시작

코루틴 

    private Coroutine leftAttackCoroutine;    // 코루틴 캐싱

    // 아래 fixedUpdate는 0.02초 주기이기에 계산 잘해야할거같음
    private WaitForFixedUpdate fixedUpdate = new WaitForFixedUpdate(); // yield return fixedUpdate캐싱
    private WaitForSeconds waitSecond = new WaitForSeconds(0.3f);

이런식으로 캐싱했고

leftAttackCoroutine = StartCoroutine(LeftClickAttack()); 이런방식으로 사용했음

근데 이게 맞는 방식인지 확신이 서질 않음 30분 이상 검색 해보았지만 내가 이해하긴엔
너무 심연이였기에 일단 사용해보니 기능은 정상작동하는것으로 확인

오후 10:51 2023-08-06
애니메이션 확인해보니 Any State 에 Jump 와 Attack 이 있는데 Any State 의 우선순위가 너무
높아서 여기서 다른곳으로 이어도 계속 플레이 되는것을 확인 나중에 AnimatorComtroler수정 필요

오후 10:59 2023-08-06
이동하면서 공격하면 AddForce가 주는힘이 씹히면서 이동속도에 맞춰짐 이 부분 고쳐야할거같음




오후 11:07 2023-08-06

궁굼한것 

(1)위에 코드에서 코루틴을 캐싱했는데 이렇게 캐싱해서 사용하는 것이 맞는지?
(1-1)자주 사용하는것이기 때문에 캐싱을 진행했는데 위 사용방법이 틀렸을 경우 어떻게 사용해야 하는지?

(2) 두 애니메이션을 연결 시키고 싶어서 조건을 주고 연결을 시킴
    둘다 AnyState에 있는것들인데 안가는 이유가 AnyState의 우선순위가 높아서 그런것인지?

	오전 9:20 2023-08-07
	싰으면서 생각해보니 Ani.SetBool안해준거같음


오전 10:41 2023-08-07
위 문제는 해결했음 SetBool을 해주지 않은것이 문제였음

오전 10:41 2023-08-07
지금 이동키를 누르며 공격을 하면 AddForce가주는 힘을 무시하고 움직임의 속도를 따라가는데
이것을 공격할때에 몇초간 이동하지 못하게 짤예정임 근데 시간을 정해주어야 하는데
그것을 코루틴으로 해야 할거같음 시도시작

오전 10:58 2023-08-07
어느정도 만족스러운 결과물이 나옴 움직일때에 속도가 확줄어드는 경우가 줄어든것이 보임

이제 공격할떄에 AddForce 힘을 좀더 늘려주어야 할거같음
늘려주었고 playerRigid를 Zero로 초기화 시켜주었더니 공격후 뚝 끊기는거 같음
1의 수치를 주어야 부드러울거 같음

Vector3.one 을 주니 좀더 좋아졌지만 뒤를 눌렀을때에 앞으로감 조건을 추가해야할거같음

뒤를 눌렀을때에 Vector3.one * -1 로 해결


오전 11:25 2023-08-07
몸통 중앙 기준으로 위를 누르면 윗공격 중앙 기준 좌우눌렀을떄에 좌우 공격 
나중에 상,하,좌,우 공격 처리 해야함

오전 11:37 2023-08-07
상,하,좌,우 공격 판정 만들기 시작

오후 3:37 2023-08-07
피타고라스계산식 사용해보았는데 실패했음 이유가 플레이어가 움직일떄마다 x,y값이 바뀌고
그것을 z에 삽입하니 위치마다 모션이 빙글빙글 돌아가기때문에 실패

교수님의 도움으로
var dir = playerMovementClass.mousePosition - transform.position;
                var angle = Mathf.Atan2(dir.y, dir.x) * Mathf.Rad2Deg;
                transform.rotation = Quaternion.AngleAxis(angle, Vector3.forward);

이 코드를 대입하고 안됬다가 껏다 키니까 정상 작동함 이유를 자세히 알수가 없었음
유니티의 오류였는지 사소한것을 건들이다가 고쳐진것인지 판단불가


오후 3:57 2023-08-07

12시 방향 인근 클릭시 앞으로 전진하지 않고 위로만 공격하게 만들기

실패 : 위쪽 각을 잘 구하고 조건을 걸어주어야할거같음 조건을
	(1) 마우스 포인터를 플레이어 어깨 위를 눌러야 한다 &&
	(2) 플레이어 X좌표 + 0.4 만큼의 앞을 눌렀거나 ||
	(3) 플레이어 X좌표 + -0.1 만큼위 뒤를 눌렀으면 조건 충족
이런 조건으로 시도해보았지만 위로만 이동 하게 되었음


오후 4:29 2023-08-07
플레이어 구르기 를 제작해봐야겠음
조건 : 키입력을 S누른상태에서 D 누르거나 D누르는 중에 S 누르면 구르기 
	구를 동안은 플레이어는 무적이다





구르기 애니메이션 조건 실행
계속 구르는데 Debug 찍어보니까 시간조절 잘해준다면 해결할수 있을거같음

구르기 조절 완료했음

현제 확인된 오류 : 바닥에 비비면서 공격을하면 점프 애니메이션이 계속 재생됨 
풀리긴 하지만 고치긴 해야할거같음

230808 할일 : 굴렀을때에 앞으로 AddForce로 힘을 가해주기 , 구르는중에 무적(Collider껏다키기)



=========================================================================

오전 9:47 2023-08-08
굴렀는데 움직임이 계속 앞으로 힘을 주어서 그런지 Addforce가 바로 풀리는거 같음
구르는 코루틴 돌때에 좌우 입력값 잠궈야 할거같음

구르기 완성 했음 코루틴 내부,위에 구르기 함수에서 점프가 아니고 공중상태가 아니여야하며
좌,우 입력값 무엇진지 판별하고 입력값에 맞추어서
PlayerRigid.AddForce 수치를 주어서 조정하였음

오전 10:45 2023-08-08

공격했을떄에 공격Empect 의 Active 가 켜지고 꺼지면서 조절을 하고 싶음
하지만 2번째 공격부터 정상 작동하는것이 확인되었고 
스크립트의 실행 순서,둘다 Update에 있다보니 그러는거같다고 생각이듦


해결 : 플레이어가 임펙트 오브젝트를 스크립트에서 가져온다음에
임펙트 조건을 날리고 Update 에 둠 그리고 플레이어 스크립트에서 int형 변수를 0으로 두고
임펙트가 실행되는 조건을 1로 둠 그리고 클릭했을떄에 플레이어가 1로 바꾸고 임펙트업데이트에
있는 메서드에 들어가게 되면 처음으로 조건을 바로 0으로 바꾸고 실행한뒤 빠져나가면 if문 조건에
맞지않아서 한번만 실행 되게 만들었음

오전 11:03 2023-08-08
이제 구르고 난뒤에 계속 달리는 애니메이션이 나오는데 왜 그러는지 고쳐보아야 할거같음

애니메이션이 들어가는 조건이 Bool형으로 ReadyRun -> Run 이런 식으로 가는식이였는데
ReadyRun의 조건을 Trigger로 바꾸어야 해결될거같음 조건을 찍어보니 false로 되어있는데도
구른뒤에는 들어감 

오후 1:20 2023-08-08

Debug.LogFormat("구르기 끝났을 때 / isRollRock: {0}, readyRun: {1}",
                    isRollRock, readyRun);

교수님이 이렇게 찍어보시고

       // 달리기 끄는 로직
                readyRun = false;
                playerAni.SetBool("ReadyRun", readyRun);

구르기 끝날때에 이렇게 수동으로 바꾸어 주니까 정상작동함

아까 코루틴에서 바꾸어 주었을때에 왜 안됐는지 알수가 없음

생각해보아서 그나마 가능성으로 보는것이 꺼주고 
playerAni.SetBool("ReadyRun", readyRun);
이부분을 호출하지 않아서 true 상태로 그냥 넘어간 것으로 추론됨


오후 1:23 2023-08-08

벽 붙기 판정 만들어야 할거같음

오후 2:42 2023-08-08
공격후 뛰는거 고치기	(구르기와 동일하게 해결)

S 눌렀을때에 몸 앞으로 기울이는 애니메이션과 조건 처리

플레이어 서있을 때에 콜라이더 

OffSet X: 0.07	Y: -0.03

Size X: 0.55	Y: 1.1

앉아있을때에 예상 수치

OffSet X: 0.07	Y: -0.27

Size X: 0.55	Y: 0.64

오후 3:32 2023-08-08

플레이어 S 입력시 몸을 숙이는것 구현 완료

앉아있을떄에 콜라이더수치를 수정해서 위에 서있을때 , 앉아있을떄 사이즈로 해놓았고
구를때에도 앉아있는 수치로 돌아가는것 확인됨 그리고 키를땠을때에 원래대로 돌아오도록
설정해놓았음 

오후 3:33 2023-08-08

대각선 점프할때 나올 애니메이션 구현


벽점프 벽의 x포지션 플레이어의 x포지션 계산해서 Addforce줘서 대각선점프 구현 시작


오후 3:53 2023-08-08

!오류 : 붙은벽에서 점프 이상함
	벽에서 떨어지고 나서 점프가 안됨 (점프 한뒤에 IsJump를 Debug 찍어봐야할거같음)
	찾아보니 bool형 변수를 false를 주어서 다시 점프 가능하게 해야하는데 true로 준 문제가 있었음

오후 4:28 2023-08-08

대각선 점프 구현하기위해서 벽에 붙어있을때에 playerWallGrab 상태가 true 라면
일반 점프가 아닌 대각선 점프로 가도록 조건을 주었음 그리고 대각선 점프 한뒤에 scale이
바뀌지 않아서 좌,우 구분이 이상해서 점프 마다 오른쪽인지 왼쪽인지 Collider붙었을때에 
player와 wall의 X좌표를 구분해서 RightWall,LeftWall에 구분해주었고 그 변수들 바탕으로
구현함 벽에 붙었을때에 Scale 바꾸어주고 대각선 점프 했을때에 scale 바꿔주는 식으로 만들었음
한번에 벅차 올라야 하기떄문에 Addforce를 이용하였고 그로인해 수치가 일반적인 것보다높은
감이 있음

대각 점프 어느정도 잘되는거 같음 이제 애니메이션 붙어야 할거같음 (falling ->fall )

오후 4:43 2023-08-08
붙인 결과 덤블링후 정상적으로 점프 모션으로 이어짐

오후 4:43 2023-08-08
앞뒤 Scale구분하는데 계속 New Vector 사용하고 있는데 앞뒤 값을 위 변수에 선언해놓고 
그걸 가져다 사용하는 식으로 수정해야겠음

자주 사용하는 Vector Scale 값 캐싱후 수정 완료

오후 5:14 2023-08-08
점프 했을때엔 앉는것이 안되지만 덤블링 후엔 앉는 것이 되는게 확인됨
두 코드의 차이 확인후 수정시작


오후 5:25 2023-08-08
덤블링후 점프 모션이 조금 이상한거같음 수정필요 IsJumpBool == false 일때 idle 로가니
덤블링 후 true 로주어서 조절 해야겠음

확인해보니 isJump라는 Bool형 변수를 사용하는데 이리저리 너무 많이사용해서 엉켜있음


애니메이션 Jump를 복사해서 새로 Flip에 붙이고 조건지정을 따로따로 사용하게끔해야 할거같음


!버그 : 벽에서 공격하니까 중력이 낮아진 상태로 공격하고 중력이 돌아오지 않는거 같음

오후 5:54 2023-08-08
오늘 점프 애니메이션에서 Idel애니메이션 으로 의도한바가 다르게 가는거 고치다가 마무리

230809 할일 : 덤블링 이후 jump 애니메이션 까지 잘가지만 바닥이 닿기 전에 idle 
애니메이션으로 가는 버그 고치기

벽에 붙었을때 공격하면 중력유지한체로 공격하는것 고치기 
(공격할때에 Gravity 1로 주면고쳐질 것으로 예상됨)


오전 11:25 2023-08-09

벽에 붙었을때 공격하면 중력유지한체로 공격하는것 고치기 
 공격할떄에 Gravity가 1보다 낮으면 1로 올리라고 하니까 고쳐짐 하지만 점프가 공격이후
점프가 안됨

벽점프할때에 2단점프 되는것 고침


오후 1:28 2023-08-09
애니메이터 조금 고쳐야할거같음

1 벽을 짚음

점프키 눌렀는가? 

Yes : -> 2벽점프 애니메이션

No : -> 1계속 벽짚기

1 에서 땅에 닿았나?

Yes : Idle 애니메이션

No : 벽짚기

2 벽점프 애니메이션을 실행후 땅에 닿았나?

Yes : Idle애니메이션

No : 모션 그대로 

WallGrab모션중 공격을 하면 공격이나가고 WallGrab모션으로 돌아옴

예상 : WallGrab에서 Attack으로 갔지만 남아있던 Collider인식이 다시 WallGrab으로 부른걸로
	추정


Debug 찍어봐야 하는데 그럼 벽에 붙어 있을떄에 와 공격할떄 한번씩 찍어보고
	예상이맞으면 1붙어있음 -> 2공격함 -> 1붙어있음 으로 나와야함


예상이 맞았고 코루틴으로 공격시 몇초동안 값을 변하지 못하게 하던지 코루틴으로만
값을 변화시켜서 조절해야 할거같음

완료 : 벽에 붙어있을때 Bool 형 변수 isAttackClingWallCoolTimeBool == false일때로하고
	공격했을떄 좌클릭했을떄 발생하는 함수에 코루틴으로 0.3초후 다시 붙을수 있게
	해주었더니 정상적으로됨 하지만 생각해보니 코루틴을 너무 남용하면 GC이 불필요
	하게 많이 쌓일수 있기에 if 조건문으로  isWallGrab == true 조건을 주었음
	isWallGrab이라는 Bool 변수는 벽에 붙었을때 true로 바뀌기 때문에 바닥에서
	공격할시엔 코루틴을 돌지 않도록함


오후 3:53 2023-08-09

이제 벽에서 땅을 밟았을때나 붙는 벽에서 다른 키를 눌렀을때 벽에계속 붙어있는 애니메이션
이 나오는데 이것을 위 방법처럼 다른키를 누르면 0.3초의 쿨을 주면 될거같음

if(isWallGrab == true && (player.GetButtonDown("MoveLeft") ||
 player.GetButtonDown("MoveRight") || player.GetButtonDown("DownKey")))

위 조건으로 해보았는데 Stay가 계속 올라가서 그런지 떨어져도 똑같은거 같음 어떻게 해결해야
할까

Floor 땅일때에 Bool값을 바꿔주는 무언가를 만들어서 벽에 붙는 조건에 땅에 붙지 않았을때를
넣어주면 될거같음


바닥에서 나갈때부터하면됨
playerPresentFloor = true;

오후 4:32 2023-08-09

playerPresentFloor = false; 를 CollitionExit 에 넣으니까 늦게 false가 되는것인지
 점프해서 붙는벽에 닿았을때에 애니메이터가 점프에서 Idle로 가버림


디버그 : exit에서 false로 바꾸어주는 타이밍 붙는벽 enter 타이밍 확인 해보아야할거같음

디버그 결과 : 예상과 다르게 false 된 이후에 Enter 정상적으로 들어감 그렇다면 Ani.SetTriger로
켜주는 곳이 다른곳에 있는데 그 조건에 들어가질 못하나?

디버그 찍어보니 조건에 맞았고 잘 들어감

근데 공격한뒤에 벽에 붙으면 잘되는것을 확인할수 있었는데 그럼 공격할떄에 변수랑
그냥 점프해서 붙었을떄 변수의 차이를 확인하고 고쳐야 할거같음


오후 6:08 2023-08-09
1시간 교수님과 문제점을 유심히 본결과

fix: 벽에 잘붙음 Debug.LogFormat으로 찍어보았지만 문제가 발견되지 않았고 
애니메이터 에서 Jump -> Idle로 가는것 , WallGrab -> Idle로 가는 2가지를 끊었다가
다시 붙여보니 정상작동으로 되었음 문제점을 찾기 너무어려웠고
추후 재발할 가능성이 충분하게 보이기때문에 경과를 잘 지켜보아야 겠음




오전 9:48 2023-08-10
WallGrab상태에서 어느 순간에 WallGrabToIdle을 부르는지 확인해야됨


오후 1:23 2023-08-10

현재 LaserPassage 맵 타일깔았음 총 맵의X길이 61정도 Max X Pos : 52 Min X Pos : -8.9

LaserPassage 카메라 Min Position X : 6 	Y : 1.5
		  Max Positon X : 43.5	Y : 1.5

오후 1:38 2023-08-10
씬이름을 가져와서 그 이름에 따라 카메라의 움직임 제한을 각자 다르게 줌

private Scene nowScene;

오후 2:32 2023-08-10
맵 장애물Obj 레이저 쏘는 기믹 만들기

(1) 기믹의 스프라이트는 있지만 레이저 점선의 스프라이트와 공격시 스프라이트가 없기 때문에
직접 제작

(2) 움직일수 있는 기믹과 움직이지 못하는 기믹구분은 점선 색으로 구분 

(3) Collition.tag 가 Player면 공격

1-2 플레이어를 감지 하였을떄에 나오는 파 노 파 노 색갈 순으로 레이저 쏘기

노란색 RGB 255,180,0  	FFB400
하늘색 RGB 40,130,220 	2882DC


오후 6:01 2023-08-10

현재 레이저 로직 구성중

컬러 캐싱완료

줄어드는 스케일 캐싱 완료

Active == True 일때 실행 시킬 코루틴 구성 중 완료

레이저 Default 사이즈 캐싱해야됨 완료

플레이어 Trigger 조건 제작 해야됨

오전 10:49 2023-08-11
레이저 움직이게 해야함 그걸 2개로 스크립트를 나누었음 이동 만 하게 하는것과
콜라이더 인식해주는 스크립트로 나눔

두개 나누어 두었었는데 둘이 합쳤고 한캐의 스크립트로 가능하게 만들었음 코드 길이가
크게 많지않아서 합쳤고 나중에 다른 곳에서 끌어다 쓸때에도 더욱 편리성이 생김

오후 12:09 2023-08-11
스위치 OnOFF조정을 TriggerStay에서 하니까 겹쳤을때20번정도 빨리돌고 더 안돔 그래서
범위 안에 있는동안 꽤나 많이 씹히는데 이렇게 되면

변수하나 만들어주고 그 면수를 Enter와 Exit 에서 바꾸고 그 변수값이 Enter 값일때 바꿀수
있게 만들어야 할거같음


오후 3:21 2023-08-11

   // 다른클레스에서 알아야하는 bool을 매개변수로 받는 이벤트선언
    public event Action<bool> switchButtionboolChanged;

    // 실질적 스위치 On,Off 구문해줄 bool
    private bool isSwitchOn = true;

    // 스위치 바꿀떄 잠시만 true로 해서 과도한 이벤트 발생 안시키기위한 bool 변수
    public bool isTouchButton = false;

    public bool IsSwitchOn
    {
        
        get { Debug.Log("get에 들어가나?"); return isSwitchOn; }
        set
        {
            Debug.Log("Set에 들어가나?");
            if (isSwitchOn != value && isTouchButton) // && isTouchButton == true && switchControlNum == 1
            {
                Debug.Log("이벤트에 들어오나?");
                isSwitchOn = value;
                // 이벤트 호출 및 매개변수 전달
                switchButtionboolChanged?.Invoke(isSwitchOn);
            }
            else { /*PASS*/ }
        }
    }

---------------------------------------------------------------------------------

                //  { 스페이스 입력하면 스위치 온,오프 조정
                if (IsSwitchOn == true)
                {
                    switchSpriteRenderer.sprite = switchSprite[0];
                    IsSwitchOn = false;
                    touchButton = StartCoroutine(ChangeTouchSwitch());

                }

이런 식으로 불러주면 if(문에선 isSwitchOn 의 값을 불러와서 비교하고)

IsSwitchOn = false;

이런식으로 대입 할때에는 Set 을 불러오기 떄문에
Set의

 isSwitchOn = value; 이 부분이 대입되어서 같이 변경되는걸로 됨


이렇게 만들었는데 비교문일때 Get을 부르고 대입 문에선 Set 을 부른다.

오류가 있었는데 그부분이 만들어놓고 이벤트 구독까지 했지만 참조를 안했었기 떄문에
아예 불러오질 못했음 이방식을 사용할때에 Get과 Set이 어느 시점에서 Call 되는것인지
인지를 잘해야 사용 가능할것으로 예상됨

오후 5:41 2023-08-11

스위치로 레이저는 잘꺼지게 되었지만 player를 인식했을때에 Dotted_Line을 끄고 Shot 하고
다시키는것에 오류가 생김 DottedLine이 스위치를 끄기 전까지 안꺼지고 켜진상태에서
레이저를 쏘게됨

문제를 보니 DottedLine이 SetActive 가 절대적으로 True가 됨 꺼지지 않음



GetCurrentAnimatorStateInfo에대해 공부하기

